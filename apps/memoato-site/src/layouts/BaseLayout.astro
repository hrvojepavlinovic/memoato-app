---
type Props = {
  title: string;
  description?: string;
  canonicalPath?: string;
  ogType?: "website" | "article";
  ogImagePath?: string;
};

import "../styles/global.css";

const { title, description, canonicalPath, ogType = "website", ogImagePath = "/og.png" } = Astro.props;
const databuddyClientId =
  import.meta.env.PUBLIC_DATABUDDY_CLIENT_ID?.trim() || "c1678578-eedf-4cbc-bbc6-8dfa541712dc";

const canonical = canonicalPath
  ? new URL(canonicalPath, Astro.site ?? "https://memoato.com").toString()
  : undefined;
const ogImage = ogImagePath ? new URL(ogImagePath, Astro.site ?? "https://memoato.com").toString() : undefined;

const baseJsonLd = {
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Organization",
      "@id": "https://memoato.com/#organization",
      name: "HILLS Lab",
      url: "https://hills-lab.hr",
      brand: { "@type": "Brand", name: "memoato" },
      sameAs: ["https://x.com/memoatoo", "https://github.com/hrvojepavlinovic/memoato-app"],
    },
    {
      "@type": "WebSite",
      "@id": "https://memoato.com/#website",
      url: "https://memoato.com",
      name: "memoato",
      inLanguage: "en",
      publisher: { "@id": "https://memoato.com/#organization" },
    },
  ],
};
const baseJsonLdString = JSON.stringify(baseJsonLd);
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title}</title>
    {description ? <meta name="description" content={description} /> : null}
    {canonical ? <link rel="canonical" href={canonical} /> : null}

    <link rel="icon" href="/favicon.ico" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />

    <meta name="theme-color" content="#ffffff" />
    <meta property="og:site_name" content="memoato" />
    <meta property="og:type" content={ogType} />
    <meta property="og:title" content={title} />
    {description ? <meta property="og:description" content={description} /> : null}
    {canonical ? <meta property="og:url" content={canonical} /> : null}
    {ogImage ? <meta property="og:image" content={ogImage} /> : null}
    {ogImage ? <meta property="og:image:width" content="1200" /> : null}
    {ogImage ? <meta property="og:image:height" content="630" /> : null}
    {ogImage ? <meta property="og:image:alt" content="memoato: minimal habit tracking" /> : null}

    <meta name="twitter:card" content={ogImage ? "summary_large_image" : "summary"} />
    <meta name="twitter:site" content="@memoatoo" />
    <meta name="twitter:title" content={title} />
    {description ? <meta name="twitter:description" content={description} /> : null}
    {canonical ? <meta name="twitter:url" content={canonical} /> : null}
    {ogImage ? <meta name="twitter:image" content={ogImage} /> : null}
    {ogImage ? <meta name="twitter:image:alt" content="memoato: minimal habit tracking" /> : null}

    <script type="application/ld+json" set:html={baseJsonLdString} />

    <slot name="head" />

    <!-- Keep as a literal <script> tag (avoid Astro hoisting to ESM import, which loses data-* attrs). -->
    <Fragment
      set:html={`<script src="https://cdn.databuddy.cc/databuddy.js"
        data-client-id="${databuddyClientId}"
        data-track-attributes="true"
        data-track-outgoing-links="true"
        data-track-interactions="true"
        crossorigin="anonymous"
        async></script>`}
    />
  </head>
  <body>
    <header class="topbar">
      <div class="topbar-inner">
        <a class="brand" href="/">
          <span class="logo">
            <img src="/logo.png" alt="memoato" width="18" height="18" />
          </span>
          <span>memoato</span>
        </a>
        <div class="header-actions">
          <nav class="navlinks">
            <a class="btn sm" href="/about">About</a>
            <a class="btn sm" href="/help">Help</a>
            <a class="btn sm" href="/blog">Blog</a>
            <a class="btn sm" href="/privacy">Privacy</a>
          </nav>
          <a
            class="icon-btn"
            href="https://github.com/hrvojepavlinovic/memoato-app"
            rel="noopener noreferrer"
            aria-label="GitHub"
            title="GitHub"
            target="_blank"
          >
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path
                d="M12 .5a12 12 0 0 0-3.8 23.4c.6.1.8-.2.8-.5v-2c-3.3.7-4-1.4-4-1.4-.6-1.5-1.4-1.9-1.4-1.9-1.2-.8.1-.8.1-.8 1.3.1 2 .1 2.8 1.9 1.1 1.9 2.9 1.4 3.6 1.1.1-.8.4-1.4.7-1.7-2.7-.3-5.4-1.4-5.4-6.1 0-1.3.5-2.4 1.2-3.2-.1-.3-.5-1.6.1-3.3 0 0 1-.3 3.3 1.2a11.4 11.4 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.7.2 3 .1 3.3.8.8 1.2 1.9 1.2 3.2 0 4.7-2.7 5.8-5.4 6.1.4.3.8 1.1.8 2.2v3.3c0 .3.2.6.8.5A12 12 0 0 0 12 .5Z"
              />
            </svg>
          </a>
          <a class="btn primary" href="https://app.memoato.com" rel="noreferrer" referrerpolicy="no-referrer">
            Open app
          </a>
        </div>
      </div>
    </header>

    <main>
      <slot />
    </main>

    <footer class="footer">
      <div class="container footer-grid">
        <div class="footer-brand">
          <a class="brand" href="/">
            <span class="logo">
              <img src="/logo.png" alt="memoato" width="18" height="18" />
            </span>
            <span>memoato</span>
          </a>
          <div style="margin-top: 0.75rem">
            Minimal habit tracking for ADHD brains: fast input, clear progress, fewer decisions.
          </div>
          <div style="margin-top: 1rem; display: flex; gap: 0.75rem; flex-wrap: wrap; align-items: center">
            <a class="btn primary sm" href="https://app.memoato.com" rel="noreferrer" referrerpolicy="no-referrer">
              Open app
            </a>
            <a
              class="icon-btn"
              href="https://x.com/memoatoo"
              rel="noopener noreferrer"
              aria-label="X"
              title="X"
              target="_blank"
            >
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                  d="M18.9 2H22l-6.8 7.8L23.2 22h-6.4l-5-6.5L6 22H2.8l7.3-8.4L1 2h6.6l4.6 6 6.7-6Zm-1.1 18h1.8L7.5 3.9H5.6L17.8 20Z"
                />
              </svg>
            </a>
            <a
              class="icon-btn"
              href="https://buymeacoffee.com/0xhp10"
              rel="noopener noreferrer"
              aria-label="Donate"
              title="Donate"
              target="_blank"
            >
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                  d="M17 8h1a4 4 0 0 1 0 8h-1v2a3 3 0 0 1-3 3H8a3 3 0 0 1-3-3V8h12Zm1 6a2 2 0 0 0 0-4h-1v4h1Z"
                />
                <path d="M7 2h2v3H7V2Zm4 0h2v3h-2V2Z" />
              </svg>
            </a>
            <a
              class="icon-btn"
              href="https://github.com/hrvojepavlinovic/memoato-app"
              rel="noopener noreferrer"
              aria-label="GitHub"
              title="GitHub"
              target="_blank"
            >
              <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path
                  d="M12 .5a12 12 0 0 0-3.8 23.4c.6.1.8-.2.8-.5v-2c-3.3.7-4-1.4-4-1.4-.6-1.5-1.4-1.9-1.4-1.9-1.2-.8.1-.8.1-.8 1.3.1 2 .1 2.8 1.9 1.1 1.9 2.9 1.4 3.6 1.1.1-.8.4-1.4.7-1.7-2.7-.3-5.4-1.4-5.4-6.1 0-1.3.5-2.4 1.2-3.2-.1-.3-.5-1.6.1-3.3 0 0 1-.3 3.3 1.2a11.4 11.4 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.6 1.7.2 3 .1 3.3.8.8 1.2 1.9 1.2 3.2 0 4.7-2.7 5.8-5.4 6.1.4.3.8 1.1.8 2.2v3.3c0 .3.2.6.8.5A12 12 0 0 0 12 .5Z"
                />
              </svg>
            </a>
          </div>
        </div>
        <div class="footer-col">
          <div class="muted">Project</div>
          <ul class="list">
            <li><a href="/about">About</a></li>
            <li><a href="/blog">Blog</a></li>
            <li><a href="/open-source">Open source</a></li>
            <li><a href="/help">Help & FAQ</a></li>
            <li><a href="/contact">Contact</a></li>
          </ul>
        </div>
        <div class="footer-col">
          <div class="muted">Legal</div>
          <ul class="list">
            <li><a href="/privacy">Privacy policy</a></li>
            <li><a href="/terms">Terms</a></li>
          </ul>
          <div style="margin-top: 1rem" class="muted">
            Made by <a href="https://hills-lab.hr" rel="noopener noreferrer">HILLS Lab</a> Â·
            <a href="https://hrvoje.pavlinovic.com" rel="noopener noreferrer">Hrvoje</a>
          </div>
        </div>
      </div>
    </footer>

  </body>
</html>
